<!DOCTYPE html>
<html lang="de">

<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
</head>

<body>
    <div class="header">Turnverein St. Ingbert</div>

    <div class="menu" onclick="toggleMenu()">â˜°</div>
    <ul class="menu-list" id="menuList">

        <li onclick="Start()">Schichtplan</li>

    </ul>


    <h1>Aktuelle Veranstaltung</h1>
    <table id="Veranstaltung_live">
        <div id="live">
            <tr>
                <th><b>Veranstaltung</b></th>
                <th><b>Eingeschrieben</b></th>
            </tr>
        </div>

    </table>

    <h1>Vergangene Veranstaltung</h1>
    <table id="Veranstaltung_dead">
        <div id="dead">
            <tr>
                <th><b>Veranstaltung</b></th>
                <th><b>Eingeschrieben</b></th>
            </tr>
        </div>

    </table>


    <a href="Login_site.html">
        <button id="Schichtverwaltung"><b>Schichtverwaltung</b></button>
    </a>

    <script>
window.onload = function () {
    const heute = new Date();
    const liveTable = document.getElementById("Veranstaltung_live");
    const deadTable = document.getElementById("Veranstaltung_dead");

    fetch("http://localhost:8080/shifts/getEvents")
        .then(res => res.json())
        .then(events => {
            const grouped = new Map();

            // Events gruppieren nach Name + zusammenfassen
            events.forEach(event => {
                if (!event.showEvent) return;

                const name = event.eventName;

                if (!grouped.has(name)) {
                    grouped.set(name, {
                        name: name,
                        needed: 0,
                        signedUp: 0,
                        date: null // wird gesetzt sobald ein Tag gefunden wird
                    });
                }

                const current = grouped.get(name);

                if (Array.isArray(event.days)) {
                    event.days.forEach(day => {
                        if (!current.date && day.day) {
                            current.date = new Date(day.day);
                        }

                        if (Array.isArray(day.services)) {
                            day.services.forEach(service => {
                                if (Array.isArray(service.tasks)) {
                                    service.tasks.forEach(task => {
                                        current.needed += task.neededWorker || 0;
                                        if (Array.isArray(task.workers)) {
                                            current.signedUp += task.workers.length;
                                        }
                                    });
                                }
                            });
                        }
                    });
                }
            });

            // Gruppierte Events anzeigen
            grouped.forEach(event => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${event.name}</td>
                    <td>${event.signedUp} / ${event.needed}</td>
                `;

                if (event.date && event.date < heute) {
                    deadTable.appendChild(row);
                } else {
                    liveTable.appendChild(row);
                }
            });
        })
        .catch(err => {
            console.error("Fehler beim Laden der Events:", err);
        });
};




        function toggleMenu() {
            const menu = document.getElementById('menuList');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        function Start() {

            window.location.href = "Seite.html"

        }






    </script>
</body>

</html>